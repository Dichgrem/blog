<!DOCTYPE html>
<html lang="en">

<head>
    <title>Dich&#x27;blog</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5">
    <meta name="robots" content="noodp"/>

    <link rel="stylesheet" href="https://blog.dich.ink/style.css">
    <link rel="stylesheet" href="https://blog.dich.ink/color/blue.css">

    <link rel="stylesheet" href="https://blog.dich.ink/font-hack-subset.css">

    <meta name="description" content="">

    <meta property="og:description" content="">
    <meta property="og:title" content="Dich'blog">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://blog.dich.ink/arch-install/">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:description" content="">
    <meta name="twitter:title" content="Dich'blog">
    <meta property="twitter:domain" content="blog.dich.ink">
    <meta property="twitter:url" content="https://blog.dich.ink/arch-install/">

            
        <link rel="alternate" type="application/atom+xml" title="RSS" href="https://blog.dich.ink/atom.xml">
    
    </head>

<body class="">
<div class="container">
    
    <header class="header">
        <div class="header__inner">
            <div class="header__logo">
                    
                <a href="https://blog.dich.ink" style="text-decoration: none;">
                    <div class="logo">
                      
                            Dich&#x27;blog
                        
                    </div>
                </a>
            </div>
        </div>

        
        
                <nav class="menu">
            <ul class="menu__inner">
                <li class="active"><a href="https://blog.dich.ink">blog</a></li>
            
                <li><a href="https://blog.dich.ink/tags">tags</a></li>
            
                <li><a href="https://blog.dich.ink/archive">archive</a></li>
            
                <li><a href="https://blog.dich.ink/about">about me</a></li>
            
                <li><a href="https://github.com/Dichgrem" target="_blank" rel="noopener noreferrer">github</a></li>
            </ul>
        </nav>
    
    
        
    </header>
    

    <div class="content">
        
    <div class="post">
        
    <h1 class="post-title"><a href="https://blog.dich.ink/arch-install/">Arch从命令行安装</a></h1>
    <div class="post-meta-inline">
        
    <span class="post-date">
            2023-08-05
        </span>

    </div>

    
        <span class="post-tags-inline">
                :: tags:&nbsp;
                <a class="post-tag" href="https://blog.dich.ink/tags/arch-install/">#arch-install</a></span>
    

        <div class="post-content">
            <p>前言</p>
<p>Arch linux是一个轻量、灵活、滚动更新的 Linux 发行版，衍生了诸多优秀的桌面端linux。其官方Wiki更是被称为技术界的“武林秘籍”；</p>
<p>但由于该Wiki的中文版比较陈旧，安装教程不太清楚，故先以虚拟机安装Arch为例实际操作一番。</p>
<span id="continue-reading"></span>
<p>准备工作：需要虚拟机环境（这里推荐使用VMware Workstation Pro),以及一个ISO镜像</p>
<p>VM学习版：https://www.ahhhhfs.com/33472/</p>
<p>官方镜像： https://geo.mirror.pkgbuild.com/iso/2023.08.01/</p>
<p>一.新建虚拟机</p>
<p>1.打开VM，文件—新建虚拟机—典型—下一步，对于硬盘要求建议至少20G，作为后续分区使用；CPU及内存根据实际需求分配，一般取半数。</p>
<p>注意：完成后需先在编辑虚拟机设置—选项中设置引导为UEFI，否则会导致奇怪的Boot问题。</p>
<p>2.开启此虚拟机，随后进入界面，回车，跑码后进入tty1。</p>
<p>二.联网并分区</p>
<p>1.使用 dhcpcd 命令获取IP地址，由于虚拟机使用NAT故联网容易。</p>
<p>2.使用 ping www.baidu.com 命令检查是否联网，若出现ttl,time=xx ms等数据说明成功，随后再 Ctrl+C 停止命令运行，避免百度被DDOS攻击死掉。</p>
<p>3.使用 timedatectl set-ntp true 命令更新系统时间，该命令无输出，正所谓无事发生就是最好的。</p>
<p>4.使用 fdisk -l 命令查看系统分区，由于虚拟机的存在只会显示一块硬盘。</p>
<p>5.接下来是Arch安装中较难的一部分，以20G硬盘空间为例，我们需要划分出512MB的引导分区，15G的根分区以及5G左右的交换分区。由于纯命令行分区比较繁琐，这里使用 cfdisk 命令打开分区工具。</p>
<p>回车选择gpt类型，可以看到如下界面：</p>
<p>使用左右方向键移动至New,新建一个分区，大小为512MB,回车确认，并移动至type将其类型改为EFI system，随后如法炮制，建立根分区（类型为linux filesystem）和交换分区（linux swap）。</p>
<p>注意：上诉操作完成后需在Write中选择yes,否则无法保存分区，随后quit回到命令行。</p>
<p>6.分区结束后分别对其进行格式化，命令为</p>
<p>mkfs.fat -F32 /dev/sda1</p>
<p>mkfs.ext4 /dev/sda2</p>
<p>mkswap -f /dev/sda3</p>
<p>注意不同分区类型与格式所用命令不同。</p>
<p>7.格式完成后进行挂载，使用如下命令：</p>
<p>swapon /dev/sda3</p>
<p>mount /dev/sda2 /mnt</p>
<p>mkdir /dev/sda2 /mnt/home</p>
<p>ls /mnt</p>
<p>mkdir /mnt/boot</p>
<p>mkdir /mnt/boot/EFI</p>
<p>mount /dev/sda1 /mnt/boot/EFI</p>
<p>ls /mnt</p>
<p>完成后即可开始组件下载。</p>
<p>三.安装基本组件</p>
<p>1.使用大名鼎鼎的vim编辑器，将下载镜像源改为国内，提高下载速度 </p>
<p>vim /etc/pacman.d/mirrorlist</p>
<p>推荐使用清华源，在首行中改为如下命令：</p>
<p><span class="line">Server = http://mirrors.tuna.tsinghua.edu.cn/archlinux/$repo/os/$arch</span></p>
<p>随后ESC，:  wq保存退出。</p>
<p>2.安装基本包，使用命令</p>
<p>pacstrap /mnt base base-devel linux linux-firmware dhcpcd</p>
<p>一路回车下载。</p>
<p>3.生成fstab文件 ，使用命令</p>
<p>genfstab -U /mnt &gt; /mnt/etc/fstab</p>
<p>自动挂载分区，并用</p>
<p>cat /mnt/etc/fstab</p>
<p>观察分区情况。</p>
<p>4.使用arch-chroot /mnt命令切换至系统环境下，此时可以设置时区，语言和主机名（hostname）。</p>
<p>设置上海为系统时区：</p>
<p>ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</p>
<p>设置主机名：vim /etc/hostname，写入任意你想要的名字。随后在vim /etc/hosts中输入如下内容，将name改为主机名。</p>
<p>127.0.0.1 localhost</p>
<p>::1 localhost</p>
<p>127.0.1.1 name.localdomain name</p>
<p>设置语言： 使用vim /etc/locale.gen命令去掉 en_US.UTF-8 UTF-8 以及 zh_CN.UTF-8 UTF-8 行前的注释符号，并用locale-gen生成新locale，用</p>
<p>echo 'LANG=en_US.UTF-8' &gt; /etc/locale.conf</p>
<p>命令确认输出。</p>
<p>4.设置root密码：使用passwd命令，设置并重复密码。</p>
<p>5.安装微码：根据硬件选择命令：</p>
<p>pacman -S intel-ucode # Intel</p>
<p>pacman -S amd-ucode # AMD</p>
<p>6.安装引导程序：pacman -S grub efibootmgr os-prober与GRUB：</p>
<p>grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=ARCH</p>
<p>生成配置文件：grub-mkconfig -o /boot/grub/grub.cfg</p>
<p>7.退出并重启虚拟机：</p>
<p>exit # 退回安装环境</p>
<p>umount -R /mnt # 卸载新分区</p>
<p>reboot # 重启</p>
<p>若成功进入登录界面即为成功，可使用neofetch命令打印系统信息。</p>
<p>四.安装图形界面</p>
<p>为便于在虚拟机中操作，我们可以安装KDE-plasma，Xfce等桌面环境。</p>
<p>1.使用dhcpcd获得地址。</p>
<p>2.新建普通用户</p>
<p>useradd -m -G wheel username #替换username为你的用户名</p>
<p>并设置密码passwd username 。</p>
<p>3.配置Sudo,使用pacman -S sudo安装并在</p>
<p>ln -s /usr/bin/vim /usr/bin/vivisudo</p>
<p>中删除 %wheel ALL=(ALL)ALL 前的注释符。</p>
<p>4.reboot后开始安装驱动。由于NVIDIA fuck you 众所周知的原因，独显驱动比较难以安装，建议先只上核显。</p>
<p>以此为例，若为AMD核显，命令为</p>
<p>sudo pacman -S xf86-video-amdgpu</p>
<p>OpenGL和mesa:</p>
<p>sudo pacman -S mesa xf86-video-amdgpu vulkan-radeon libva-mesa-driver mesa-vdpau</p>
<p>sudo pacman -S opencl-mesa lib32-vulkan-radeon lib32-mesa</p>
<p>5.使用命令</p>
<p>pacman -S plasma-meta konsole dolphin</p>
<p>安装KDE组件。</p>
<p>6.开启sddm守护进程：</p>
<p>systemctl enable sddm</p>
<p>systemctl start sddm</p>
<p>7.reboot后进入桌面环境，安装完成。</p>
<p>后记</p>
<p>设备的多样导致安装中可能会出现一些奇怪的问题，需要自行搜索学习，以不断提高技术水平。</p>

        </div>

        
        <div class="pagination">
            <div class="pagination__title">
                <span class="pagination__title-h">Thanks for reading! Read other posts?</span>
                <hr />
            </div>
            <div class="pagination__buttons">
                
                    <span class="button next">
                        <a href="https://blog.dich.ink/dsm-nas/">
                            <span class="button__text">黑群辉极速安装</span>&nbsp;
                            <span class="button__icon">→</span>
                        </a>
                    </span>
                </div>
        </div>
    
    </div>

    </div>

    
    <footer class="footer">
        <div class="footer__inner">
                <div class="copyright">
                        <span>© 
    2024
 Dichgrem</span>
                    <span class="copyright-theme">
                        <span class="copyright-theme-sep">:: </span>
                        Theme: <a href="https://github.com/pawroman/zola-theme-terminimal/">Terminimal</a> by pawroman
                    </span>
                </div>
            </div>
    </footer>
    

</div>
</body>

</html>
